using System;
using System.IO;
using System.Linq;
using System.Runtime.InteropServices;
using System.Threading.Tasks;
using k8s;
using Microsoft.AspNetCore.Hosting;
using Microsoft.Extensions.Configuration;
using Microsoft.Extensions.DependencyInjection;
using Microsoft.Extensions.Hosting;
using Microsoft.Extensions.Logging;

namespace Container.Vulnerability.Agent
{
    class Program
    {
        static async Task Main(string[] args)
        {
            var config = new KubernetesClientConfiguration {  Host = "http://127.0.0.1:8001" };
            var client = new Kubernetes(config);
            var pods = await client.ListPodForAllNamespacesAsync();

            var images = pods.Items
                .SelectMany(x => x.Spec.Containers)
                .Select(x => x.Image)
                .Where(x => !x.Contains("/google_containers/") && !x.Contains("/google-containers/"))
                .Distinct();
        }
    }
}
