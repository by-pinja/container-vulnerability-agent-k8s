# container-vulnerability-agent

[![Build Status](https://jenkins.protacon.cloud/buildStatus/icon?job=www.github.com/container-vulnerability-agent-k8s/master)](https://jenkins.protacon.cloud/job/www.github.com/job/container-vulnerability-agent-k8s/job/master/)
[![Generic badge](https://img.shields.io/docker/pulls/ptcos/container-vulnerability-agent-k8s.svg)](/ptcos/container-vulnerability-agent-k8s.svg)

Agent software for kubernetes cluster with [https://github.com/protacon/container-vulnerability-scanner](https://github.com/protacon/container-vulnerability-scanner)

Implemented as very minimalistic command line tool expected to run as
cronjob inside of cluster.

## Examples

Get information from proxied cluster.

```bash
kubectl proxy
```

```bash
dotnet run --kubeProxy:http://127.0.0.1:8001
```

Get help

```bash
dotnet run -- --help

Usage:  [options]

Options:
  -?|-h|--help            Show help information
  --kubeProxy:<URL>       Kubernetes api proxy address (example http://127.0.0.1:8001). If address is not defined tool excepts to be running inside of pod in cluster.
  --scannerApi:<API_URL>  Uri of scanner api (example http://localhost:5000). If left empty agent prints what it should send to api if defined.
  --apiKey:<API_KEY>      Apikey for reporting api
  --collectGceInfo        Read google cluster information from http://metadata.google.internal. Use cluster name as group id if set.
  --groupId:<GROUP_ID>    Group id
```

### K8s

```yaml
apiVersion: batch/v1beta1
kind: CronJob
metadata:
  name: vulnerability-agent
  namespace: infra
spec:
  concurrencyPolicy: Forbid
  failedJobsHistoryLimit: 3
  successfulJobsHistoryLimit: 3
  jobTemplate:
    spec:
      template:
        spec:
          containers:
          - args:
            - --scannerApi:http://1.2.3.4
            - --auth:'user:pass'
            - --collectGceInfo
            image: ptcos/container-vulnerability-agent-k8s:latest
            name: agent
          restartPolicy: Never
  # At 01:00 on Sunday
  schedule: '0 1 * * SUN'
```
